<!DOCTYPE html>
<html lang="en">
<head>
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>URL Shortener</h1>
        <form id="shorten-form">
            <div>
                <label for="url">Enter URL:</label>
                <input type="url" id="url" name="url" required>
            </div>
            <div>
                <label for="shortCod">Enter shortCode:</label>
                <input type="text" id="shortCode" name="shortCode" required>
            </div>
            <button type="submit">Shorten</button>
        </form>
        <h2>Shortened URLs</h2>
        <ul id="shortened-urls"></ul>
    </div>

    <script>

        const fetchShortenedURL=async()=>{
           const response=await fetch('/links');
           const links=await response.json();

           const list=document.getElementById('shortened-urls');
           list.innerHTML='';

           for(const [shortCode,url] of Object.entries(links)){
                const li=document.createElement('li');
                const trucatedUrl=url.length>=30?`${url.slice(0,30)}...`:url;
        
                li.innerHTML=`<a href="/${shortCode}" target="_blank">${window.location.origin}/${shortCode}</a> -> ${trucatedUrl}`;
                list.appendChild(li);
            }
        }

        document.getElementById('shorten-form').addEventListener('submit',async(event)=>{
            event.preventDefault();

            const formData=new FormData(event.target);
            const url=formData.get('url');
            const shortCode=formData.get('shortCode');
            
            try{
                const response=await fetch('/shorten',{
                    method:'POST',
                    headers:{
                        'Content-Type':'application/json'
                    },
                    body:JSON.stringify({url,shortCode})
                });
                if(response.ok){
                    await fetchShortenedURL();
                    alert('URL submitted successfully!');
                    event.target.reset(); 
                }else{
                    const errorData=await response.text();
                    alert(`Error: ${errorData}`);
                }
            }catch(error){
                console.error('Error:',error);
            }
        })
        fetchShortenedURL();
    </script>
</body>
</html>